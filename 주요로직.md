# Samyang3 프로젝트 주요 로직

## 1. 🔐 인증/인가 시스템 (세션 기반)

### 핵심 구현
- **LoginInterceptor**: 모든 요청에 대한 로그인 여부 체크
  - 세션에서 `loginUser` 객체 확인
  - 미인증 시 원래 요청 URL 저장 후 로그인 페이지로 리다이렉트
  - 로그인 후 원래 요청했던 페이지로 자동 이동

- **AdminInterceptor**: 관리자 권한 체크
  - `/admin/*` 경로에 대한 접근 제어
  - `UserVO.isAdmin` 플래그로 관리자 여부 판단
  - 권한 없을 시 메인 페이지로 리다이렉트

### 기술적 특징
- Spring Interceptor 패턴 활용
- 세션 타임아웃: 30분
- 예외 경로 설정 (로그인, 회원가입, 정적 리소스 등)

---

## 2. 🛒 장바구니 관리 시스템

### 핵심 비즈니스 로직
- **중복 상품 처리**: 이미 담긴 상품 추가 시 수량만 증가
- **재고 검증**: 장바구니 수량 변경 시 실시간 재고 확인
- **총액 계산**: 상품별 가격 × 수량의 합계 자동 계산

### 기술적 구현
```java
// CartService.java:28-40
if (existingCart != null) {
    // 이미 있으면 수량만 증가
    int newQuantity = existingCart.getQuantity() + cart.getQuantity();
    return cartMapper.updateQuantity(existingCart.getCartID(), newQuantity) > 0;
} else {
    // 없으면 새로 추가
    return cartMapper.insertCart(cart) > 0;
}
```

---

## 3. 📦 주문 처리 프로세스 (트랜잭션)

### 주문 생성 플로우
1. **재고 확인**: 장바구니 상품별 재고 검증
2. **주문 생성**: Orders 테이블에 주문 정보 저장
3. **주문 상품 생성**: OrderItem 테이블에 상품별 정보 저장
4. **재고 차감**: Product 테이블의 stock 감소
5. **장바구니 비우기**: 주문 완료 후 장바구니 초기화

### 트랜잭션 관리
```java
@Transactional(rollbackFor = Exception.class)
public Long createOrder(OrderVO order, List<CartVO> cartItems) {
    // 모든 작업이 성공해야 커밋, 하나라도 실패하면 전체 롤백
}
```

### 예외 처리
- 재고 부족 시 즉시 예외 발생
- 주문/주문상품 생성 실패 시 롤백
- 사용자에게 명확한 에러 메시지 전달

---

## 4. 👤 회원 관리 시스템

### 회원가입 프로세스
- **아이디 중복 체크**: username 유니크 검증
- **이메일 중복 체크**: email 유니크 검증
- **기본 권한 설정**: isAdmin = false (일반 사용자)

### 로그인 처리
- **비밀번호 평문 비교** (보안 취약점 - 실제 서비스에서는 암호화 필수)
- 로그인 성공 시 UserVO 객체를 세션에 저장
- 장바구니 개수 등 사용자 정보 세션에 캐싱

---

## 5. 🏪 상품 관리 시스템

### 재고 관리
- **실시간 재고 확인**: checkStock() 메소드로 주문 가능 여부 판단
- **재고 차감**: updateStock() 메소드로 트랜잭션 내에서 처리
- **동시성 제어**: MyBatis의 낙관적 락 활용 (stock = stock - #{quantity})

### 카테고리 관리
- 동적 카테고리 목록 조회
- 카테고리별 상품 필터링
- 검색 기능 (상품명, 설명 LIKE 검색)

---

## 6. 💳 결제 프로세스

### 무료배송 정책
- 3만원 이상 구매 시 배송비 무료
- 3만원 미만 시 3,000원 배송비 부과

### 주문 상태 관리
- 주문완료 → 배송준비 → 배송중 → 배송완료
- 주문완료 상태에서만 취소 가능
- 관리자만 상태 변경 권한 보유

---

## 7. 🗄️ 데이터베이스 설계 특징

### Foreign Key 없는 설계
- 애플리케이션 레벨에서 참조 무결성 관리
- 개발 편의성 증대, 성능 향상
- 데이터 정합성 리스크 존재

### MyBatis 설정
- Type Alias 자동 매핑
- Underscore to CamelCase 자동 변환
- 동적 SQL 활용 (검색, 필터링)

---

## 8. 🎨 View 계층 구조

### JSP 기반 렌더링
- `/WEB-INF/views/` 디렉토리 구조
- 카테고리별 JSP 파일 분리 (user/, product/, order/ 등)
- JSTL 태그 라이브러리 활용

### 정적 리소스 관리
- Spring Resource Handler 설정
- `/static/css/`, `/static/js/`, `/static/images/` 매핑
- 캐싱 전략 미적용 (개발 환경)

---

## 9. 🔧 관리자 기능

### 대시보드
- 실시간 통계 (회원 수, 상품 수, 주문 수)
- 대기 중인 주문 알림
- 최근 주문 목록 표시

### 관리 기능
- 회원 관리: 관리자 권한 토글
- 상품 관리: CRUD 및 재고 관리
- 주문 관리: 상태 변경 및 배송 처리

---

## 10. 🛡️ 보안 및 성능 고려사항

### 현재 구현된 보안
- 세션 기반 인증
- Interceptor를 통한 접근 제어
- SQL Injection 방지 (PreparedStatement)

### 개선 필요 사항
- **비밀번호 암호화**: BCrypt 등 해시 알고리즘 적용 필요
- **CSRF 토큰**: POST 요청에 대한 CSRF 방어 필요
- **XSS 방어**: 사용자 입력값 이스케이프 처리 필요
- **API 인증**: RESTful API에 JWT 토큰 인증 추가 필요

### 성능 최적화 포인트
- **N+1 쿼리 문제**: 주문 목록 조회 시 Join 쿼리 최적화 필요
- **캐싱 전략**: Redis를 활용한 세션 및 상품 정보 캐싱
- **페이징 처리**: 대량 데이터 조회 시 페이징 구현 필요
- **비동기 처리**: 주문 알림, 이메일 발송 등 비동기 처리 필요